<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Pre and post conditions - C3 Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Pre and post conditions";
    var mkdocs_page_input_path = "preconditions.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ebnf.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bnf.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> C3 Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">About C3</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installing</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../setup/">Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="../firstproject/">Your first project</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Documentation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../changesfromc/">Changes from C</a>
                </li>
                <li class="">
                    
    <a class="" href="../compare/">Comparisons with other languages</a>
                </li>
                <li class="">
                    
    <a class="" href="../examples/">Examples</a>
                </li>
                <li class="">
                    
    <a class="" href="../modules/">Modules</a>
                </li>
                <li class="">
                    
    <a class="" href="../types/">Types</a>
                </li>
                <li class="">
                    
    <a class="" href="../arrays/">Arrays</a>
                </li>
                <li class="">
                    
    <a class="" href="../functions/">Functions</a>
                </li>
                <li class="">
                    
    <a class="" href="../statements/">Statements</a>
                </li>
                <li class="">
                    
    <a class="" href="../expressions/">Expressions</a>
                </li>
                <li class="">
                    
    <a class="" href="../errorhandling/">Errors</a>
                </li>
                <li class="">
                    
    <a class="" href="../undefinedbehaviour/">Undefined behaviour</a>
                </li>
                <li class="">
                    
    <a class="" href="../conversion/">Conversions</a>
                </li>
                <li class="">
                    
    <a class="" href="../builtinmacros/">Built-in Macros</a>
                </li>
                <li class="">
                    
    <a class="" href="../precedence/">Precedence</a>
                </li>
                <li class="">
                    
    <a class="" href="../generics/">Generics</a>
                </li>
                <li class="">
                    
    <a class="" href="../macros/">Macros</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Pre and post conditions</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#pre-and-post-conditions">Pre and post conditions</a></li>
    

    <li class="toctree-l3"><a href="#pre-conditions">Pre conditions</a></li>
    

    <li class="toctree-l3"><a href="#post-conditions">Post conditions</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#const-in-detail">Const in detail</a></li>
        
            <li><a class="toctree-l4" href="#pure-in-detail">Pure in detail</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="#pre-conditions-for-macros">Pre conditions for macros</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../library/">Library</a>
                </li>
                <li class="">
                    
    <a class="" href="../ideas/">Crazy ideas</a>
                </li>
                <li class="">
                    
    <a class="" href="../naming/">Naming rules</a>
                </li>
                <li class="">
                    
    <a class="" href="../comments/">Comments & Docs</a>
                </li>
                <li class="">
                    
    <a class="" href="../attributes/">Attributes</a>
                </li>
                <li class="">
                    
    <a class="" href="../cinterop/">C Interop</a>
                </li>
                <li class="">
                    
    <a class="" href="../syntax/">Grammar</a>
                </li>
                <li class="">
                    
    <a class="" href="../sample/">More code examples</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Build system</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../buildintro/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../project/">Project Structure</a>
                </li>
                <li class="">
                    
    <a class="" href="../buildcommands/">Commands</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Development</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../contribute/">Contribute</a>
                </li>
                <li class="">
                    
    <a class="" href="../changes/">Changes</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">C3 Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Documentation &raquo;</li>
        
      
    
    <li>Pre and post conditions</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="pre-and-post-conditions">Pre and post conditions</h1>
<p>Pre and post conditions are optional checks that the compiler may use for optimization and runtime checks. Note that <em>compilers are not obliged to process pre and post conditions at all</em>. However, violating either pre or post conditions is considered undefined behaviour, so a compiler may optimize as if they always hold â€“ even if a potential bug may cause them to be violated.</p>
<h1 id="pre-conditions">Pre conditions</h1>
<p>Pre conditions are usually used to validate incoming arguments. Each condition must be an expression that can be evaluated to a boolean. A pre condition use the <code>@require</code> annotation.</p>
<pre><code>/**
 * @require foo &gt; 0, foo &lt; 1000
 **/
func int testFoo(int foo)
{
    return foo * 10;
}
</code></pre>

<h1 id="post-conditions">Post conditions</h1>
<p>Post conditions are evaluated to make checks on the resulting state after passing through the function. There are two special post conditions: <code>const</code> and <code>pure</code>.</p>
<p>The post condition uses the <code>@ensure</code> annotation. Where <code>return</code> is used to mark the return value from the function. </p>
<p>For <code>const</code> and <code>pure</code>, they can either be given as separate annotations: <code>@pure</code> and <code>@const &lt;parameter&gt;, ...</code>, or inside an <code>@ensure</code> using the format <code>const(&lt;parameter&gt;)</code> and <code>pure(&lt;function name&gt;)</code>. A parameter marked <code>const</code> guarentees that the memory pointed to is not altered within the scope of a function. <code>pure</code> guarantees that the function does not read or write to any global variables.</p>
<pre><code>/**
 * @ensure foo != nil, const(foo), return &gt; foo.x;
 * @pure
 **/
func uint checkFoo(Foo* foo)
{
    uint y = abs(foo.x) + 1;
    // If we had row: foo.x = 0, then this would be a compile time error.
    return y * abs(foo.x);
}
</code></pre>

<h3 id="const-in-detail">Const in detail</h3>
<p>The <code>const</code> annotation allows a program to make assumtions in regards of how the function treats the parameter. This can then be used by a compiler make optimizations for any caller of the function.</p>
<p>However, it should be noted that the compiler might not detect whether the annotation is correct or not! This program might compile, but will behave strangely:</p>
<pre><code>func void badFunc(int* i)
{
    *i = 2;
}

/**
 * @ensure const(i)
 */
func void lyingFunc(int* i)
{
    badFunc(i); // The compiler might not check this!
}

func void test()
{
    int a = 1;
    lyingFunc(&amp;a);
    printf(&quot;%d&quot;, a); // Might print 1!
}
</code></pre>

<p>However, compilers will usually detect this:</p>
<pre><code>
/**
 * @ensure const(i)
 */
func void badFunc(int* i)
{
    *i = 2; // &lt;- Compiler error: violating post condition const(i)
}
</code></pre>

<h3 id="pure-in-detail">Pure in detail</h3>
<p>The <code>pure</code> annotation allows a program to make assumtions in regards of how the function treats global variables. Unlike for <code>const</code>, a pure function is not allowed to call a function which is known to be impure.</p>
<p>However, just like for <code>const</code> the compiler might not detect whether the annotation is correct or not! This program might compile, but will behave strangely:</p>
<pre><code>int i = 0;

type SecretFunc func void();

func void badFunc()
{
    i = 2;
}

SecretFunc foo = nil;

/**
 * @pure
 */
func void lyingFunc()
{
    SecretFunc(); // The compiler cannot reason about this!
}

func void test()
{
    foo = &amp;badFunc;
    i = 1;
    lyingFunc();
    printf(&quot;%d&quot;, a); // Might print 1!
}
</code></pre>

<p>However, compilers will usually detect this:</p>
<pre><code>int i = 0;

func void badFunc()
{
    i = 2;
}

/**
 * @pure
 */
func void lyingFunc()
{
    badFunc(); // Error! Calling an impure function
}
</code></pre>

<p>Consequently circumventing "pure" annotations is undefined behaviour.</p>
<h1 id="pre-conditions-for-macros">Pre conditions for macros</h1>
<p>Macros have an additional class of pre conditions, that are used to confirm that the values actually will work inside the macro body. This improves the error messages, since otherwise it would be hard to know if the error is in the implementation of the macro, or in the parameters. These are placed under the <code>@reqparse</code> annotation, or together with the <code>@require</code> annotations, surrounded by <code>parse()</code>. </p>
<pre><code>/**
 * @reqparse resource.open()
 * @require resource != nil, parse(void *x = resource.open())
 **/
macro openResource(resource)
{
    return resource.open();
}
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../library/" class="btn btn-neutral float-right" title="Library">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../macros/" class="btn btn-neutral" title="Macros"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../macros/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../library/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
